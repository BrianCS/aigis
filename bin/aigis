#!/usr/bin/env node

var argv = require('yargs')
  .alias('v', 'version')
  .version(function() { return require('../package').version; })
  .describe('v', 'show version information')
  .alias('h', 'help')
  .demand(1, 'Usage: aigis run -c ./path/to/aigis_config.yml')
  .usage('Usage: aigis run -c ./path/to/aigis_config.yml')
  .showHelpOnFail(false, 'Specify --help for available options')
  .detectLocale(false)
  .help('help')
  .command('run', 'generate styleguide', {
    'c': {
      alias: 'config',
      describe: 'path to config file',
      default: './aigis_config.yml'
    }
  }, run)
  .command('init', 'copy template & config file', {}, init)
  .argv

function run(argv) {
  var Aigis = require('../index');
  var aigis;

  try {
    aigis = new Aigis(argv.config);
    aigis.run();
  }
  catch(e) {
    console.error(e.message);
    process.exit(1);
  }
}

function init() {
  var path = require('path');
  var fs = require('fs-extra');
  var cwd = path.resolve();
  var exampleDir = path.join(__dirname, '../examples');

  var assets = [
    'template',
    'aigis_config.yml',
  ];

  assets.forEach(function(name) {
    var _path = path.join(exampleDir, name);
    var _dest = path.join(cwd, name);
    fs.copySync(_path, _dest);
    console.log('copy:', _dest);
  });
}
